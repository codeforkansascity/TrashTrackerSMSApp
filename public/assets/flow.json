{
  "description": "A New Flow",
  "states": [
    {
      "name": "Trigger",
      "type": "trigger",
      "transitions": [
        {
          "next": "initial_reply",
          "event": "incomingMessage"
        },
        {
          "event": "incomingCall"
        },
        {
          "event": "incomingConversationMessage"
        },
        {
          "event": "incomingRequest"
        },
        {
          "event": "incomingParent"
        }
      ],
      "properties": {
        "offset": {
          "x": 0,
          "y": 0
        }
      }
    },
    {
      "name": "final_object_confirmation",
      "type": "send-message",
      "transitions": [
        {
          "next": "http_request_english_1",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 590,
          "y": 1320
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Got it. We will add it to our cleanup\nlist. Thank you for using Trash\nTracker."
      }
    },
    {
      "name": "initial_spanish_reply",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "regular_spanish_split",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -560,
          "y": 1430
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Gracias por contactar a Trash Tracker. Si desea informar sobre el vertido, envíe un mensaje de texto con \"Ubicación: [Ingrese la ubicación del vertido]\". Puedes decir \"English\" para inglés.",
        "timeout": "3600"
      }
    },
    {
      "name": "after_location_confirmed",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "after_photo_confirmed",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 180,
          "y": 780
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Thank you. It looks like you sent us\nlocation information. Can you send us a photo to help us identify the location?",
        "timeout": "3600"
      }
    },
    {
      "name": "sorry_no_match_english",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "regular_english_split",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -1090,
          "y": 550
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Sorry, I don't understand. Please include one of the following keywords to indicate what you would like to say:  Español, Location.",
        "timeout": "3600"
      }
    },
    {
      "name": "after_ubicacion_confirmed",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "after_foto_confirmed",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -380,
          "y": 2100
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Gracias. Parece que nos enviaste\nInformación sobre la ubicación. ¿Puedes enviarnos una foto para ayudarnos a identificar la ubicación?",
        "timeout": "3600"
      }
    },
    {
      "name": "confirmacion_final",
      "type": "send-message",
      "transitions": [
        {
          "next": "http_request_spanish",
          "event": "sent"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -380,
          "y": 2890
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "to": "{{contact.channel.address}}",
        "body": "Entiendo. Lo añadiremos a nuestra limpieza.\nlista. Gracias por usar Papelera\nRastreador."
      }
    },
    {
      "name": "sorry_no_match_spanish",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "regular_spanish_split",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -1090,
          "y": 2000
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Lo siento, no entiendo. Incluya una de las siguientes palabras clave para indicar lo que le gustaría decir: español, ubicación, objeto.",
        "timeout": "3600"
      }
    },
    {
      "name": "regular_english_split",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "sorry_no_match_english",
          "event": "noMatch"
        },
        {
          "next": "after_location_confirmed",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to Location",
              "arguments": ["{{widgets.initial_reply.inbound.Body}}"],
              "type": "contains",
              "value": "Location"
            }
          ]
        },
        {
          "next": "initial_spanish_reply",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to Español",
              "arguments": ["{{widgets.initial_reply.inbound.Body}}"],
              "type": "contains",
              "value": "Español"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.initial_reply.inbound.Body}}",
        "offset": {
          "x": 10,
          "y": 490
        }
      }
    },
    {
      "name": "initial_reply",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "regular_english_split",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 0,
          "y": 200
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Thank you for contacting Trash Tracker. If you want to report a dumping, please text \"Location: [Enter the location of the dumping]\". You can say \"Español\" for Spanish.",
        "timeout": "3600"
      }
    },
    {
      "name": "regular_spanish_split",
      "type": "split-based-on",
      "transitions": [
        {
          "next": "sorry_no_match_spanish",
          "event": "noMatch"
        },
        {
          "next": "after_ubicacion_confirmed",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to ubicacion",
              "arguments": ["{{widgets.initial_spanish_reply.inbound.Body}}"],
              "type": "contains",
              "value": "ubicación"
            }
          ]
        },
        {
          "next": "initial_reply",
          "event": "match",
          "conditions": [
            {
              "friendly_name": "If value equal_to English",
              "arguments": ["{{widgets.initial_spanish_reply.inbound.Body}}"],
              "type": "contains",
              "value": "English"
            }
          ]
        }
      ],
      "properties": {
        "input": "{{widgets.initial_spanish_reply.inbound.Body}}",
        "offset": {
          "x": -550,
          "y": 1770
        }
      }
    },
    {
      "name": "http_request_english_1",
      "type": "make-http-request",
      "transitions": [
        {
          "event": "success"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": 600,
          "y": 1670
        },
        "method": "POST",
        "content_type": "application/x-www-form-urlencoded;charset=utf-8",
        "body": "",
        "parameters": [
          {
            "value": "{{widgets.after_photo_confirmed.inbound.Body}}",
            "key": "object"
          },
          {
            "value": "{{widgets.initial_reply.inbound.Body}}",
            "key": "location"
          },
          {
            "value": "{{trigger.message.From}}",
            "key": "report_from"
          },
          {
            "value": "{{widgets.after_location_confirmed.inbound.Body}}",
            "key": "photo"
          },
          {
            "value": "{{widgets.sorry_no_match_english.inbound.Body}}",
            "key": "others"
          }
        ],
        "url": "https://4544-136-35-208-96.ngrok.io"
      }
    },
    {
      "name": "http_request_spanish",
      "type": "make-http-request",
      "transitions": [
        {
          "event": "success"
        },
        {
          "event": "failed"
        }
      ],
      "properties": {
        "offset": {
          "x": -370,
          "y": 3190
        },
        "method": "POST",
        "content_type": "application/x-www-form-urlencoded;charset=utf-8",
        "body": "",
        "parameters": [
          {
            "value": "{{widgets.initial_spanish_reply.inbound.Body}}",
            "key": "ubicacion"
          },
          {
            "value": "{{widgets.after_foto_confirmed.inbound.Body}}",
            "key": "objeto"
          },
          {
            "value": "{{trigger.message.From}}",
            "key": "report_from"
          },
          {
            "value": "{{widgets.after_ubicacion_confirmed.inbound.Body}}",
            "key": "foto"
          },
          {
            "value": "{{widgets.sorry_no_match_spanish.inbound.Body}}",
            "key": "others"
          }
        ],
        "url": "https://4544-136-35-208-96.ngrok.io"
      }
    },
    {
      "name": "after_photo_confirmed",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "final_object_confirmation",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": 610,
          "y": 1000
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Great. What is dumped there?",
        "timeout": "3600"
      }
    },
    {
      "name": "after_foto_confirmed",
      "type": "send-and-wait-for-reply",
      "transitions": [
        {
          "next": "confirmacion_final",
          "event": "incomingMessage"
        },
        {
          "event": "timeout"
        },
        {
          "event": "deliveryFailure"
        }
      ],
      "properties": {
        "offset": {
          "x": -380,
          "y": 2460
        },
        "service": "{{trigger.message.InstanceSid}}",
        "channel": "{{trigger.message.ChannelSid}}",
        "from": "{{flow.channel.address}}",
        "body": "Excelente. ¿Qué se tira allí?",
        "timeout": "3600"
      }
    }
  ],
  "initial_state": "Trigger",
  "flags": {
    "allow_concurrent_calls": true
  }
}
